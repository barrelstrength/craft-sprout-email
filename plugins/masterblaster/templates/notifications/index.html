{% extends "masterblaster/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set body %}

	
	{# If there are Section-based Campaigns, Display them. #}
	{% set campaigns = craft.masterblaster.getNotifications() %}
	
	{% if not campaigns|length %}
		<p>No notifications have been created yet.  <a href="{{ url('masterblaster/notifications/new') }}">Create your first notification</a>.</p>
	{% endif %}

	{% for campaign in campaigns %}

		{% if loop.first %}
		
		<table id="campaigns" class="data">
			<thead>
				<th width="8%">Date</th>
				<th width="92%">Notification Name</th>
				<td class="thin"></td>
			</thead>
		{% endif %}
		
			<tr data-id="{{ campaign.id }}"  data-name="{{ campaign.name|t }}">
				<td><span style="color: #999;text-transform:uppercase;font-size:.8em">{{ campaign.dateUpdated|date('d M Y') }}</span></td>
				<td>
					<a href="{{ url('masterblaster/notifications/edit/') }}/{{ campaign.id }}#tab-campaign-info"><strong>{{ campaign.name }}</strong></a>
				</td>
				<td class="thin">
					<a class="delete icon" title="Delete"></a>
				</td>
			</tr>

		{% if loop.last %}
		</table>
		{% endif %}

	{% endfor %}


 	
<div class="buttons">
	<a class="btn submit add icon" href="{{ url('masterblaster/notifications/new') }}">New Notification</a>
</div>

{% if brandMessageFooter is defined %}
	{{ brandMessageFooter }}
{% endif %}

{% endset %}

{% set js %}
	new Craft.AdminTable({
		tableSelector: '#campaigns',
		noObjectsSelector: '#nocampaigns',
		deleteAction: 'masterblaster/campaigns/delete'
	});
	
	jQuery(document).ready(function(){
		jQuery('.export').click(function(){
			var query = 'entryId='+jQuery(this).closest('tr').attr('data-entry-id')
			+ '&campaignId='+jQuery(this).closest('tr').attr('data-id')
			+ '&action=masterblaster/campaigns/export';
			$.post('{{ url('masterblaster/campaigns/export') }}',query, function(data){
				alert(data);
			})
			return false;
		})
	})
{% endset %}
{% includeJs js %}
