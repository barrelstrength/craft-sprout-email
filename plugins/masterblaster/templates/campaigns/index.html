{% extends "masterblaster/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set body %}

	{% set campaigns = craft.masterblaster.getSectionCampaigns() %}
	
	{% if not campaigns|length %}
		<p>No Campaigns have been created yet.  <a href="{{ url('masterblaster/campaigns/new') }}">Create your first campaign</a>.</p>
	{% endif %}

	{# If there are Section-based Campaigns, Display them. #}
	{% for campaign in campaigns %}
			
		{% if loop.first %}
		<table id="campaigns" class="data">
			<thead>
				<th width="8%">Date</th>
				<th width="32%">Campaign Name</th>
				<th width="20%">Preview</th>
				<th width="40%">Publish</th>
				<td class="thin"></td>
			</thead>
		{% endif %}
		
			<tr data-id="{{ campaign.id }}" data-entry-id="{{ campaign.entryId }}" data-name="{{ campaign.name|t }}">
				<td style="line-height:12px;">
					<span style="color: #999;text-transform:uppercase;font-size:.8em">{{ campaign.dateUpdated|date('d M Y') }}</span>
				</td>
				<td>
					<a href="{{ url('masterblaster/campaigns/edit/') }}/{{ campaign.id }}#tab-campaign-info"><strong>{{ campaign.name }}</strong></a>
				</td>
				<td>
					<a href="{{ siteUrl }}/{{campaign.htmlTemplate}}?sectionId={{campaign.sectionId}}&handle={{campaign.handle}}&entryId={{campaign.entryId}}&slug={{campaign.slug}}" target="_blank">HTML</a> 
					/ 
					<a href="{{ siteUrl }}/{{campaign.textTemplate}}?sectionId={{campaign.sectionId}}&handle={{campaign.handle}}&entryId={{campaign.entryId}}&slug={{campaign.slug}}" target="_blank">Text</a> 
					
				</td>
				<td>
					Send 
					| 
					<a href="#" class="export" >Export</a>  
					| 
					Status

					<div style="color:#fff;background-color: #bbb;display:inline-block;font-size:10px;font-weight: bold;text-transform: uppercase;padding:1px 6px;margin-left:10px;border-radius:3px;">{{ campaign.emailProvider }}</div>
				</td>
				<td class="thin">
					<a class="delete icon" title="Delete"></a>
				</td>
			</tr>

		{% if loop.last %}
		</table>

		<div class="buttons">
			<a class="btn submit add icon" href="{{ url('masterblaster/campaigns/new') }}">New Campaign</a>
		</div>

		{% endif %}

	{% endfor %}


 	


{% if brandMessageFooter is defined %}
	{{ brandMessageFooter }}
{% endif %}

{% endset %}

{% set js %}
	new Craft.AdminTable({
		tableSelector: '#campaigns',
		noObjectsSelector: '#nocampaigns',
		deleteAction: 'masterblaster/campaigns/delete'
	});
	
	jQuery(document).ready(function(){
		jQuery('.export').click(function(){
			var query = 'entryId='+jQuery(this).closest('tr').attr('data-entry-id')
			+ '&campaignId='+jQuery(this).closest('tr').attr('data-id')
			+ '&action=masterblaster/campaigns/export';
			$.post('{{ url('masterblaster/campaigns/export') }}',query, function(data){
				alert(data);
			})
			return false;
		})
	})
{% endset %}
{% includeJs js %}
