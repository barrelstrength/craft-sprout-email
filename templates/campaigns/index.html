{% extends "sproutemail/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set body %}

	{% set campaigns = craft.sproutEmail.getSectionCampaigns() %}

	{# If there are Section-based Campaigns, Display them. #}
	{% for campaign in campaigns %}
		
		{% if loop.first %}
		<h3>Section-Based Campaigns</h3>
		<table id="campaigns" class="data">
			<thead>
				<th width="25%"></th>
				<th width="35%"></th>
				<th width="15%"></th>
				<th width="20%"></th>
				<td class="thin"></td>
			</thead>
		{% endif %}
		
			<tr data-id="{{ campaign.id }}" data-entry-id="{{ campaign.entryId }}" data-name="{{ campaign.name|t }}">
				<td>
					<strong>{{ campaign.title }}</strong>
					&nbsp;&nbsp;<span style="color: #999;text-transform:uppercase;font-size:.8em">{{ campaign.dateUpdated|date('F d, Y') }}</span>
				</td>
				<td>
					<a href="{{ url('sproutemail/campaigns/edit/') }}/{{ campaign.id }}">
						{{ campaign.name }} Campaign Info
					</a> / 
					<a href="{{ url('sproutemail/campaigns/edit/') }}/{{ campaign.id }}/template">
						Templates
					</a> /
					<a href="{{ url('sproutemail/campaigns/edit/') }}/{{ campaign.id }}/recipients">
						Recipients
					</a>
				</td>
				
				{% if campaign.sectionId and campaign.entryId and campaign.textTemplate and campaign.emailProvider %}
				<td>				    
					<a href="{{ siteUrl }}{{campaign.htmlTemplate}}?sectionId={{campaign.sectionId}}&handle={{campaign.handle}}&entryId={{campaign.entryId}}&slug={{campaign.slug}}" target="_blank">HTML</a> 
					/ 
					<a href="{{ siteUrl }}{{campaign.textTemplate}}?sectionId={{campaign.sectionId}}&handle={{campaign.handle}}&entryId={{campaign.entryId}}&slug={{campaign.slug}}" target="_blank">Text</a> 
				</td>
				<td>
					<a href="#" class="export" >Export to {{ campaign.emailProvider }}</a> 
				</td>
				{% else %}
				<td colspan=2">
				<i>This campaign is incomplete.</i>
				</td>
				{% endif %}
				<td class="thin">
					<a class="delete icon" title="Delete"></a>
				</td>
			</tr>

		{% if loop.last %}
		</table>
		{% endif %}

	{% endfor %}


	{% if campaigns|length %}
	 	
		<div class="buttons">
			<a class="btn submit add icon" href="{{ url('sproutemail/campaigns/new') }}">New Campaign</a>
		</div>

	{% else %}
	 	
	 	<div style="width:40%;">

		 	<h2>Create your first Campaign</h2>

		 	<p>Section-based Campaigns are a great way to leverage the power of Craft to manage your content and the benefits of a dedicated email program to manage your email.</p>

		 	<div class="buttons">
				<a class="btn submit icon" href="{{ url('sproutemail/campaigns/new') }}">Create a Campaign &raquo;</a>
			</div>

		</div>

	{% endif %}


{% endset %}

{% set js %}
	new Craft.AdminTable({
		tableSelector: '#campaigns',
		noObjectsSelector: '#nocampaigns',
		deleteAction: 'SproutEmail/campaigns/delete'
	});
	
	jQuery(document).ready(function(){
		jQuery('.export').click(function(){
			var query = 'entryId='+jQuery(this).closest('tr').attr('data-entry-id')
			+ '&campaignId='+jQuery(this).closest('tr').attr('data-id')
			+ '&action=SproutEmail/campaigns/export';
			$.post('{{ url('SproutEmail/campaigns/export') }}',query, function(data){
				alert(data);
			})
			return false;
		})
	})
{% endset %}
{% includeJs js %}
