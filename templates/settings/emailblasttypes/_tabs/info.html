
<form method="post" action="" accept-charset="UTF-8" data-saveshortcut data-saveshortcut-redirect="{{ url('sproutemail/settings/emailblasttypes/edit/{id}') }}">
	<input type="hidden" name="action" value="sproutEmail/emailBlastType/saveEmailBlastType">
	<input type="hidden" name="redirect" value="sproutemail/emailblasts">
	<input type="hidden" name="id" value="{{ emailBlastTypeId }}">
	<input type="hidden" name="tab" value="info">
	<input type="hidden" name="continue" value="false">
	<input type="hidden" name="templateOption" value="3">

	<div id="tab-emailBlastType-info" class="tab-content" >

	{% set emailProviders = craft.sproutEmail.getEmailProviders(true) %}
	
	{% if emailProviders %}
	
		{{ forms.textField({
			label: "Email Blast Type Name"|t,
			id: 'name',
			name: 'name',
			instructions: "Human readable name for this type of Email Blast"|t,
			value: (emailBlastType is defined ? emailBlastType.name : null),
			autofocus: true,
			required: true,
			errors: (emailBlastType is defined ? emailBlastType.getErrors('name') : null) 	
		}) }}

		{{ forms.textField({
			label: "Email Blast Type Handle"|t,
			id: 'handle',
			name: 'handle',
			instructions: "How you'll refer to this section in the templates."|t,
			value: (emailBlastType is defined ? emailBlastType.handle : null),
			required: true,
			errors: (emailBlastType is defined ? emailBlastType.getErrors('handle') : null) 	
		}) }}

		<hr>

		{{ forms.checkboxField({
			label: "Email Blasts of this type have their own URLs"|t,
			id: 'hasUrls',
			name: 'hasUrls',
			checked: emailBlastType.hasUrls,
			toggle: 'url-settings'
		}) }}

		<div id="url-settings" class="nested-fields{% if not emailBlastType.hasUrls %} hidden{% endif %}">

			{{ forms.textField({
				label: "Email Blast URL Format"|t,
				instructions: 'What the online version of the Email Blast URLs should look like. You can include tags that output entry properties, such as {slug} or {postDate|date("Y")}.'|t,
				placeholder: 'email/{slug}',
				name: 'urlFormat',
				value: (emailBlastType is defined ? emailBlastType.urlFormat : null),
				required: true,
				errors: (emailBlastType is defined ? emailBlastType.getErrors('urlFormat') : null)  
			}) }}

			
			{{ forms.textField({
				label: "Email Blast Template"|t,
				id: 'template',
				name: 'template',
				instructions: "The template to use when an Email Blast's URL is requested.  The text version of the Email will use the same template name and append .txt"|t,
				placeholder: 'email/_emailblasttemplate',
				value: (emailBlastType is defined ? emailBlastType.template : null),
				errors: (emailBlastType is defined ? emailBlastType.getErrors('template') : null) 	
			}) }}

			{% if emailBlastType.emailProvider == 'CopyPaste' %}
				
				{{ forms.textField({
					label: "Email Blast Copy/Paste Template"|t,
					id: 'templateCopyPaste',
					name: 'templateCopyPaste',
					instructions: "The template to use if you want to copy only part of your template.  The text version of the Copy/Paste content will use the same template name and append .txt"|t,
					placeholder: 'email/copypaste-template',
					value: (emailBlastType is defined ? emailBlastType.templateCopyPaste : null),
					errors: (emailBlastType is defined ? emailBlastType.getErrors('templateCopyPaste') : null) 	
				}) }}

			{% endif %}

		</div>

		<hr>

		{{ forms.checkboxField({
			label: "Additional control over Title and Subject Line"|t,
			id: 'hasAdvancedTitles',
			name: 'hasAdvancedTitles',
			checked: emailBlastType.hasAdvancedTitles,
			toggle: 'advancedtitle-settings'
		}) }}

		<div id="advancedtitle-settings" class="nested-fields{% if not emailBlastType.hasAdvancedTitles %} hidden{% endif %}">

			{{ forms.textField({
				label: "Title Format"|t,
				instructions: "What the auto-generated Email Blast titles should look like. You can include tags that output entry properties, such as {ex}."|t({ ex: '<code>{myCustomField}</code>' }),
				id: 'titleFormat',
				name: 'titleFormat',
				value: (emailBlastType is defined ? emailBlastType.titleFormat : null),
				errors: (emailBlastType is defined ? emailBlastType.getErrors('titleFormat') : null),
			}) }}

			{% set fieldOptions = craft.sproutEmail.getPlainTextFields() %}
			
			{{ forms.selectField({
				label: "Subject Field"|t,
				id: 'subjectHandle',
				name: 'subjectHandle',
				instructions: "Select the field that will be your subject field for the emailBlastType"|t,
				options: fieldOptions,
				value: (emailBlastType is defined ? emailBlastType.subjectHandle : null),
				errors: (emailBlastType is defined ? emailBlastType.getErrors('subjectHandle') : null) 	
			}) }}

		</div>

		<hr>

		{{ forms.selectField({
			label: "How would you like to send this email"|t,
			instructions: 'Select the platform you will use to send your Email Blasts. Add support for more services via your <a href="' ~ url('sproutemail/settings#settings-api') ~ '">API settings</a>'|t,
			name: 'emailProvider',
			id: 'emailProvider',
			required: true,
			options : emailProviders,
			value: (emailBlastType is defined ? emailBlastType.emailProvider : null),
			errors: (emailBlastType is defined ? emailBlastType.getErrors('emailProvider') : null)  
		}) }}
		
		{# Provider Specific Settings #}
		{% for emailProvider in emailProviders %}

			{% if craft.sproutEmail.getGeneralSettingsTemplate(emailProvider) %}

				<div id="{{ emailProvider }}-generalsettings-template" class="generalsettings"   >
					{% include "sproutemail/_providers/" ~ emailProvider ~ "/generalEmailBlastTypeSettings" %}
				</div>
			 
			 {% else %}
			 
			 	<div id="{{ emailProvider }}-generalsettings-template"  class="generalsettings"  >
					{% include "sproutemail/_partials/generalEmailBlastTypeSettings" %}
			 	</div>

			 {% endif %}
		{% endfor %}
	
	</div>
	
	<div class="buttons">
		<input class="btn" type="submit" value="Save Info">
		<input class="btn submit save-and-continue" id="info" type="button" value="Save Info &amp; Continue">
	</div>
	
	{% else %}
		
		<p>Manage and send your email marketing and notification emails directly from Craft.</p>
		<ul>
			<li>Sprout Email</li>
		</ul>

		<p>In you want to set up an Email Blast Type to send via a third party, you must first provide valid API settings for one of the supported email service providers.</p>

		<ul>
			<li>Campaign Monitor</li>
			<li>MailChimp</li>
			<li>MailGun</li>
			<li>SendGrid</li>
		</ul>

		<p>Just need to get up and running or integrating with a horrible service that makes you feel like it's 1980?</p>

		<ul>
			<li>Copy &amp; Paste</li>
		</ul>
		
		<p><a href="{{ url('sproutemail/settings') }}" >Set API Settings Now</a></p>
	
	{% endif %}
</form>

<hr>

<form method="post" action="" accept-charset="UTF-8">
	<input type="hidden" name="action" value="sproutEmail/emailBlastType/deleteEmailBlastType">
	<input type="hidden" name="redirect" value="sproutemail/emailblasts">
	<input type="hidden" name="id" value="{{ emailBlastTypeId }}">
	<input type="submit" class="btn small" value="Delete">
</form>

{% set js %}
	{% if emailBlastType is not defined or not emailBlastType.handle %}
		new Craft.HandleGenerator('#name', '#handle');
	{% endif %}
{% endset %}

{% includeJs js %}